#!/usr/bin/env bash
set -e

echo "Installing vagrant plugins..."
vagrant plugin install vagrant-libvirt 2>/dev/null || true
vagrant plugin install vagrant-mutate 2>/dev/null || true

echo "Setting up Ubuntu 14.04 box..."
if ! vagrant box list | grep -q "rapid7/metasploitable3-ub1404.*libvirt"; then
    echo "Downloading VirtualBox box..."
    vagrant box add rapid7/metasploitable3-ub1404 --provider virtualbox 2>/dev/null || true
    echo "Converting to libvirt..."
    vagrant mutate rapid7/metasploitable3-ub1404 libvirt --input-provider virtualbox
fi

echo "Starting VM..."
vagrant up
